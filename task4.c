#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <signal.h>

int a = 1;

void handler(int signo, siginfo_t *si, void *context) { 
  if (signo == SIGUSR1){
    printf("%d. ???????? ?????? SIGUSR1(%d).\n",a++, si->si_value.sival_int);	//???????? ??????? ???????????? ??????, ??????? ?????????? ?????, ????????? ????????????? ???????, ???.??????????
  }
  //exit(EXIT_SUCCESS);
}

int main(void) {
  pid_t pid, cpid;	
  int flag;
  struct sigaction sigAction;	//????????? ??? ?????????? ?????????
  union sigval value;		//?????????? ??? ???????? ???.??????????

  sigAction.sa_sigaction = handler;
  sigAction.sa_flags = SA_SIGINFO;		//?????? ???? sa_sigaction ?????????? ???????????? ??????? ????????? ???????? ? ?????? ?????????? void my_handler(int signo, siginfo_t *si, void *ucontext)
						//1-????? ???????, 2-????????? siginfo_t, 3- ????????? ucontext_t

  if (sigaction(SIGUSR1, &sigAction, 0) != 0) {			
    fprintf(stderr, "?????????? ?????????? SIGINT!\n");
    exit(EXIT_FAILURE);
  }

  if (signal(SIGTERM, SIG_DFL) == SIG_ERR) {		//???????????? ????????? ?? ????????? ??? ???????(SIG_DFL ??? ?????????? ??????????? ????????)
    fprintf(stderr, "?????????? ?????????? SIGINT!\n");
    exit(EXIT_FAILURE);
  }

  pid = fork(); //??????? ???????? ???????
  
  if (pid == 0) {	
      int i;
      for (i = 0; i < 10;i++){			        
	pause();  		//???????????????? ?????????? ??????? ?? ??? ???, ???? ?? ????? ?????????? ?????-?? ??????
      }
     // sleep(1);
      //pause();
  } 
  
  if (pid > 0) {
    int i;   
    for (i = 0; i < 10; i++){
      value.sival_int = i;
      sigqueue(pid, SIGUSR1, value);		//???????????? ??????? ???????? ????????? ???????? ?????? ? ?????????????? ???????????
	sleep(1);
    }
    kill(pid, SIGTERM);		//???????? ?????? ????????? ????????, ??????? ????????? ??? ??????
    cpid = wait(&flag);		//???? ?????????? ????????? ???????? ? ????????? ???????? 
    printf("??????? ??????? ??????????.\n");
  }
	
	

  return 0;
}
